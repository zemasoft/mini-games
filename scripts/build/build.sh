#!/bin/bash

set -e

SCRIPT_BASE=$(basename $(readlink -f $0))
SCRIPT_DIR=$(dirname $(readlink -f $0))

source ${SCRIPT_DIR}/setenv.sh

rm -rf build

cmake -S ${SCRIPT_DIR}/../.. -Bbuild \
      -DCMAKE_BUILD_TYPE=${BUILD_TYPE} \
      -DSLIDINGPUZZLE_USE_FREEGLUT=${USE_FREEGLUT} \
      -DSLIDINGPUZZLE_USE_GLFW=${USE_GLFW} \
      -DSLIDINGPUZZLE_USE_SDL2=${USE_SDL2} \
      -DSLIDINGPUZZLE_USE_FREEGLUT_FOR_TEXT=${USE_FREEGLUT_FOR_TEXT} \
      -DSLIDINGPUZZLE_USE_FREEALUT_FOR_AUDIO=${USE_FREEALUT_FOR_AUDIO} \
      -DSLIDINGPUZZLE_USE_SDL2_FOR_AUDIO=${USE_SDL2_FOR_AUDIO} \
      -DSLIDINGPUZZLE_WARNINGS_AS_ERRORS=${WARNINGS_AS_ERRORS} \
      -DSNAKE_USE_FREEGLUT=${USE_FREEGLUT} \
      -DSNAKE_USE_GLFW=${USE_GLFW} \
      -DSNAKE_USE_SDL2=${USE_SDL2} \
      -DSNAKE_USE_FREEALUT_FOR_AUDIO=${USE_FREEALUT_FOR_AUDIO} \
      -DSNAKE_USE_SDL2_FOR_AUDIO=${USE_SDL2_FOR_AUDIO} \
      -DSNAKE_WARNINGS_AS_ERRORS=${WARNINGS_AS_ERRORS} \
      -DVIDEOSTOP_USE_FREEGLUT=${USE_FREEGLUT} \
      -DVIDEOSTOP_USE_GLFW=${USE_GLFW} \
      -DVIDEOSTOP_USE_SDL2=${USE_SDL2} \
      -DVIDEOSTOP_USE_FREEGLUT_FOR_TEXT=${USE_FREEGLUT_FOR_TEXT} \
      -DVIDEOSTOP_USE_FREEALUT_FOR_AUDIO=${USE_FREEALUT_FOR_AUDIO} \
      -DVIDEOSTOP_USE_SDL2_FOR_AUDIO=${USE_SDL2_FOR_AUDIO} \
      -DVIDEOSTOP_WARNINGS_AS_ERRORS=${WARNINGS_AS_ERRORS}
cmake --build build
cmake --build build --target package

echo "${SCRIPT_BASE}: All OK"
